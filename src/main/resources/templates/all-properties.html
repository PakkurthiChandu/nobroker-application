<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NoBroker Clone</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: Arial, sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: #f9f9f9;
        }

        /* HEADER */
        .main-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: #fff;
            border-bottom: 1px solid #ddd;
            z-index: 1000;
            height: 60px;
        }

        .logo {
            width: auto;
            height: 30px;
            max-width: 150px; /* Adjust as needed */
            object-fit: contain; /* Prevents distortion */
        }
        .left-section {
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 200px; /* Ensures enough space for logo */
        }



        .left-section, .right-section {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo {
            width: 30px;
            height: 30px;
        }

        .brand-name {
            font-weight: bold;
            font-size: 20px;
            color: #000;
        }

        .menu-item {
            cursor: pointer;
            font-size: 14px;
            color: #333;
        }

        .pay-rent {
            background-color: #fff;
            border: 1px solid #ccc;
            color: #333;
        }

        .post-property {
            background-color: #00aa9b;
            color: #fff;
        }

        .pay-rent,
        .post-property {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }

        .profile {
            padding: 5px 10px;
            border-radius: 20px;
            background-color: #e6e6e6;
            font-size: 14px;
        }

        .icons span {
            font-size: 18px;
            margin: 0 4px;
            cursor: pointer;
        }

        .menu {
            font-size: 18px;
            cursor: pointer;
        }

        .view-toggle {
            display: flex;
            gap: 5px;
        }

        .list-view,
        .map-view {
            padding: 6px 10px;
            border-radius: 15px;
            border: none;
            background-color: #00aa9b;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
        }

        /* MAIN LAYOUT */
        .content {
            flex: 1;
            display: flex;
            overflow: hidden;
            background: #f9f9f9;
        }

        /* SIDEBAR FILTERS */
        .sidebar {
            width: 340px;
            background-color: white;
            border-right: 1px solid #ddd;
            flex-shrink: 0;
            overflow-y: auto;
            height: 100%;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
        }

        /* Filter Tabs */
        .filter-tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
        }

        .filter-tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            cursor: pointer;
            font-weight: 500;
            background: #f8f9fa;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .filter-tab.active {
            background: white;
            border-bottom: 3px solid #00aa9b;
            color: #00aa9b;
        }

        .filter-tab:hover {
            background: #e9ecef;
        }

        /* Filter Content */
        .filter-content {
            padding: 20px;
        }

        .filter-section {
            margin-bottom: 25px;
        }

        .filter-section h4 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #333;
            font-weight: 600;
        }

        .bhk-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .bhk-options label {
            flex: 1 1 45%;
            display: flex;
            align-items: center;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .bhk-options label:hover {
            border-color: #00aa9b;
            background: #f0fffe;
        }

        .bhk-options input[type="checkbox"]:checked + span,
        .radio-group input[type="radio"]:checked + span {
            color: #00aa9b;
            font-weight: 600;
        }

        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .radio-group label,
        .checkbox-group label {
            flex: 1 1 45%;
            display: flex;
            align-items: center;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .radio-group label:hover,
        .checkbox-group label:hover {
            border-color: #00aa9b;
            background: #f0fffe;
        }

        .apply-filters-btn {
            width: 100%;
            padding: 12px;
            background-color: #ff4c5b;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-top: 20px;
        }

        .apply-filters-btn:hover {
            background-color: #e43e4d;
        }

        /* MAIN AREA */
        .main-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f9f9f9;
        }

        /* Custom styles for range input thumbs */
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #007bff;
            border-radius: 50%;
            cursor: pointer;
            pointer-events: all;
            z-index: 4;
            border: 2px solid #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #007bff;
            border-radius: 50%;
            cursor: pointer;
            pointer-events: all;
            z-index: 4;
            border: 2px solid #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        input[type="range"]::-ms-thumb {
            width: 20px;
            height: 20px;
            background: #007bff;
            border-radius: 50%;
            cursor: pointer;
            pointer-events: all;
            z-index: 4;
            border: 2px solid #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* Ensure the track doesn't interfere with thumb interaction */
        input[type="range"] {
            pointer-events: none; /* Disable pointer events on the track */
        }

        input[type="range"]::-webkit-slider-thumb {
            pointer-events: all; /* Enable pointer events on the thumb */
        }

        input[type="range"]::-moz-range-thumb {
            pointer-events: all; /* Enable pointer events on the thumb */
        }

        input[type="range"]::-ms-thumb {
            pointer-events: all; /* Enable pointer events on the thumb */
        }



        .properties-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .properties-header h2 {
            margin: 0;
            font-size: 20px;
            color: #333;
        }

        .sort-dropdown {
            padding: 10px 15px;
            border-radius: 6px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
        }

        .properties-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* Property Card Styles (keeping your existing styles) */
        .property-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            max-width: 100%;
            width: 100%;
            padding: 20px;
            font-family: Arial, sans-serif;
            margin-bottom: 16px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .property-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }

        /* Premium Filter Styles */
        .premium-filter-content {
            display: none;
        }

        .premium-filter-content.active {
            display: block;
        }

        .premium-badge {
            background: linear-gradient(45deg, #ffd700, #ffed4a);
            color: #333;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
            margin-left: 8px;
        }

        input[type="checkbox"], input[type="radio"] {
            margin-right: 8px;
            accent-color: #00aa9b;
        }
    </style>
</head>
<body>

<!-- HEADER -->
<header class="main-header">
    <div th:replace="~{fragments/header :: header}"></div>
</header>

<input type="hidden" id="currentUserId" th:value="${#authentication.principal.userId}" />

<div class="content" style="margin-top: 50px">
    <div class="sidebar">
        <div class="filter-tabs">
            <div class="filter-tab active" onclick="switchTab('basic')">
                Filters
            </div>
            <div class="filter-tab" onclick="checkSubscriptionAndRedirect(event)">
                Premium Filters
                <span class="premium-badge">NEW</span>
            </div>
        </div>

        <!-- Basic Filters -->
        <div id="basic-filters" class="filter-content">
            <form id="filterForm" method="get" action="/getProperties">
                <input type="hidden" name="type" th:value="${isSale}" />
                <input type="hidden" name="city" th:value="${city}" />
                <input type="hidden" name="query" th:value="${searchKeyword}" />

                <!-- BHK Type -->
                <div class="filter-section">
                    <h4>BHK Type</h4>
                    <div class="bhk-options">
                        <div class="bhk-options" style="display: flex; flex-wrap: wrap; gap: 10px;">
                            <label style="flex: 1 1 45%;">
                                <input type="checkbox" name="bhkType" value="1" th:checked="${bhkType != null and bhkType.contains(1)}" /> 1 BHK
                            </label>
                            <label style="flex: 1 1 45%;">
                                <input type="checkbox" name="bhkType" value="2" th:checked="${bhkType != null and bhkType.contains(2)}" /> 2 BHK
                            </label>
                            <label style="flex: 1 1 45%;">
                                <input type="checkbox" name="bhkType" value="3" th:checked="${bhkType != null and bhkType.contains(3)}" /> 3 BHK
                            </label>
                            <label style="flex: 1 1 45%;">
                                <input type="checkbox" name="bhkType" value="4" th:checked="${bhkType != null and bhkType.contains(4)}" /> 4 BHK
                            </label>
                            <label style="flex: 1 1 45%;">
                                <input type="checkbox" name="bhkType" value="5" th:checked="${bhkType != null and bhkType.contains(5)}" /> 4+ BHK
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Rent Range Filter -->
                <!-- Rent Range Filter -->
                <div class="filter-section">
                    <h4>Rent Range: ₹<span id="minDisplay">0</span> to ₹<span id="maxDisplay">5,00,000</span></h4>

                    <div style="position: relative; height: 60px; margin: 20px 0;">
                        <!-- Background track -->
                        <div style="position: absolute; width: 100%; height: 6px; background: #ddd; border-radius: 3px; top: 27px; z-index: 0;"></div>

                        <!-- Active range highlight -->
                        <div id="sliderTrack" style="position: absolute; height: 6px; background: #007bff; border-radius: 3px; top: 27px; z-index: 1;"></div>

                        <!-- Min slider -->
                        <input type="range"
                               id="minRentSlider"
                               name="minRent"
                               min="0"
                               max="500000"
                               step="1000"
                               value="0"
                               oninput="syncRentRange()"
                               style="position: absolute; width: 100%; height: 60px; background: transparent; outline: none; border: none; -webkit-appearance: none; appearance: none; pointer-events: none; z-index: 3;" />

                        <!-- Max slider -->
                        <input type="range"
                               id="maxRentSlider"
                               name="maxRent"
                               min="0"
                               max="500000"
                               step="1000"
                               value="500000"
                               oninput="syncRentRange()"
                               style="position: absolute; width: 100%; height: 60px; background: transparent; outline: none; border: none; -webkit-appearance: none; appearance: none; pointer-events: none; z-index: 2;" />
                    </div>

                    <div style="display: flex; justify-content: space-between; margin-top: 10px; font-size: 14px; color: #666;">
                        <span>Min: ₹<span id="minValue">0</span></span>
                        <span>Max: ₹<span id="maxValue">5,00,000</span></span>
                    </div>
                </div>






                <!-- Availability -->
                <h4>Property Status</h4>
                <div class="filter-section" style="display: flex; flex-wrap: wrap; gap: 10px;">
                    <label style="flex: 1 1 45%; display: flex; align-items: center;">
                        <input type="radio" name="propertyStatus" value="Under Construction"
                               th:checked="${propertyStatus != null and propertyStatus == 'Under Construction'}" />
                        <span style="margin-left: 5px; white-space: nowrap;">Under Construction</span>
                    </label>

                    <label style="flex: 1 1 45%; display: flex; align-items: center;">
                        <input type="radio" name="propertyStatus" value="Ready"
                               th:checked="${propertyStatus != null and propertyStatus == 'Ready'}" />
                        <span style="margin-left: 5px; white-space: nowrap;">Ready</span>
                    </label>

                    <label style="flex: 1 1 45%; display: flex; align-items: center;">
                        <input type="radio" name="propertyStatus" value=""
                               th:checked="${propertyStatus == null or propertyStatus == ''}" />
                        <span style="margin-left: 5px; white-space: nowrap;">Any Status</span>
                    </label>
                </div>

                <!-- Property Status -->
                <h4>Furnishing</h4>
                <div class="filter-section" style="display: flex; flex-wrap: wrap; gap: 10px;">
                    <label style="flex: 1 1 30%; display: flex; align-items: center;">
                        <input type="checkbox" name="furnishing" value="Fully Furnished"
                               th:checked="${furnishing != null and furnishing.contains('Fully Furnished')}" />
                        <span style="margin-left: 5px;">Full</span>
                    </label>

                    <label style="flex: 1 1 30%; display: flex; align-items: center;">
                        <input type="checkbox" name="furnishing" value="Semi Furnished"
                               th:checked="${furnishing != null and furnishing.contains('Semi Furnished')}" />
                        <span style="margin-left: 5px;">Semi</span>
                    </label>

                    <label style="flex: 1 1 30%; display: flex; align-items: center;">
                        <input type="checkbox" name="furnishing" value="Unfurnished"
                               th:checked="${furnishing != null and furnishing.contains('Unfurnished')}" />
                        <span style="margin-left: 5px;">None</span>
                    </label>
                </div>


                <h4>Property Type</h4>
                <div class="filter-section" style="display: flex; flex-wrap: wrap; gap: 10px;">
                    <label style="flex: 1 1 30%; display: flex; align-items: center;">
                        <input type="checkbox" name="propertyType" value="Apartment"
                               th:checked="${propertyType != null and propertyType.contains('Apartment')}" />
                        <span style="margin-left: 5px;">Apartment</span>
                    </label>

                    <label style="flex: 1 1 30%; display: flex; align-items: center;">
                        <input type="checkbox" name="propertyType" value="Gated Community"
                               th:checked="${propertyType != null and propertyType.contains('Gated Community')}" />
                        <span style="margin-left: 5px;">Gated Community</span>
                    </label>

                    <label style="flex: 1 1 30%; display: flex; align-items: center;">
                        <input type="checkbox" name="propertyType" value="Villa"
                               th:checked="${propertyType != null and propertyType.contains('Villa')}" />
                        <span style="margin-left: 5px;">Villa</span>
                    </label>
                </div>

                <button type="submit" class="apply-filters-btn">Apply Filters</button>
            </form>
        </div>

        <div id="premium-filters" class="filter-content premium-filter-content"
             onclick="checkSubscriptionAndRedirect(event)">
            <form id="premium-filter-form" method="get" action="/getProperties">
                <input type="hidden" name="type" th:value="${isSale}" />
                <input type="hidden" name="city" th:value="${city}" />
                <input type="hidden" name="query" th:value="${searchKeyword}" />

                <div class="filter-section">
                    <h4>Property Age</h4>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                        <label style="flex: 1 1 30%; display: flex; align-items: center;">
                            <input type="radio" name="propertyAge" value="1"
                                   th:checked="${propertyAge != null and propertyAge == 1}" />
                            <span style="margin-left: 5px; white-space: nowrap;">&lt; 1 year</span>
                        </label>

                        <label style="flex: 1 1 30%; display: flex; align-items: center;">
                            <input type="radio" name="propertyAge" value="2"
                                   th:checked="${propertyAge != null and propertyAge == 2}" />
                            <span style="margin-left: 5px; white-space: nowrap;">&lt; 3 years</span>
                        </label>

                        <label style="flex: 1 1 30%; display: flex; align-items: center;">
                            <input type="radio" name="propertyAge" value="3"
                                   th:checked="${propertyAge != null and propertyAge == 3}" />
                            <span style="margin-left: 5px; white-space: nowrap;">&lt; 5 years</span>
                        </label>

                        <label style="flex: 1 1 30%; display: flex; align-items: center;">
                            <input type="radio" name="propertyAge" value="4"
                                   th:checked="${propertyAge != null and propertyAge == 4}" />
                            <span style="margin-left: 5px; white-space: nowrap;">&lt; 10 years</span>
                        </label>

                        <label style="flex: 1 1 30%; display: flex; align-items: center;">
                            <input type="radio" name="propertyAge" value="5"
                                   th:checked="${propertyAge != null and propertyAge == 5}" />
                            <span style="margin-left: 5px; white-space: nowrap;">10 years +</span>
                        </label>

                        <label style="flex: 1 1 30%; display: flex; align-items: center;">
                            <input type="radio" name="propertyAge" value=""
                                   th:checked="${propertyAge == null}" />
                            <span style="margin-left: 5px; white-space: nowrap;">Any Age</span>
                        </label>
                    </div>
                </div>

                <div class="filter-section">
                    <h4>Built Up Area (sq. ft.): <span id="minAreaDisplay">0</span> to <span id="maxAreaDisplay">10,000</span></h4>
                    <div style="position: relative; height: 60px; margin: 20px 0;">
                        <!-- Background track -->
                        <div style="position: absolute; width: 100%; height: 6px; background: #ddd; border-radius: 3px; top: 27px; z-index: 0;"></div>
                        <!-- Active range highlight -->
                        <div id="areaTrack" style="position: absolute; height: 6px; background: #007bff; border-radius: 3px; top: 27px; z-index: 1;"></div>
                        <!-- Min slider -->
                        <input type="range"
                               id="minAreaSlider"
                               name="minBuiltUpArea"
                               min="0"
                               max="10000"
                               step="100"
                               value="0"
                               oninput="syncAreaRange()"
                               style="position: absolute; width: 100%; height: 60px; background: transparent; outline: none; border: none; -webkit-appearance: none; appearance: none; pointer-events: none; z-index: 3;" />
                        <!-- Max slider -->
                        <input type="range"
                               id="maxAreaSlider"
                               name="maxBuiltUpArea"
                               min="0"
                               max="10000"
                               step="100"
                               value="10000"
                               oninput="syncAreaRange()"
                               style="position: absolute; width: 100%; height: 60px; background: transparent; outline: none; border: none; -webkit-appearance: none; appearance: none; pointer-events: none; z-index: 2;" />
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 10px; font-size: 14px; color: #666;">
                        <span>Min: <span id="minAreaValue">0</span></span>
                        <span>Max: <span id="maxAreaValue">10,000</span></span>
                    </div>
                </div>


                <!-- Parking -->
                <div class="filter-section">
                    <h4>Parking</h4>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                        <label style="flex: 1 1 30%; display: flex; align-items: center;">
                            <input type="checkbox" name="parking" value="Bike"
                                   th:checked="${parking != null and parking.contains('Bike')}" />
                            <span style="margin-left: 5px; white-space: nowrap;">Bike</span>
                        </label>

                        <label style="flex: 1 1 30%; display: flex; align-items: center;">
                            <input type="checkbox" name="parking" value="Car"
                                   th:checked="${parking != null and parking.contains('Car')}" />
                            <span style="margin-left: 5px; white-space: nowrap;">Car</span>
                        </label>

                        <label style="flex: 1 1 30%; display: flex; align-items: center;">
                            <input type="checkbox" name="parking" value="None"
                                   th:checked="${parking != null and parking.contains('None')}" />
                            <span style="margin-left: 5px; white-space: nowrap;">None</span>
                        </label>

                        <label style="flex: 1 1 30%; display: flex; align-items: center;">
                            <input type="checkbox" name="parking" value="Both"
                                   th:checked="${parking != null and parking.contains('None')}" />
                            <span style="margin-left: 5px; white-space: nowrap;">Both</span>
                        </label>
                    </div>
                </div>

                <button type="submit" class="apply-filters-btn">Apply Filters</button>
            </form>
        </div>
    </div>

    <!-- PROPERTY LISTINGS -->
    <div class="main-area">
        <!-- Properties Header -->

        <div class="main-area">
            <!-- Properties Header -->
            <div class="properties-header">
                <form method="get" action="/getProperties" style="display: flex; align-items: center; gap: 10px; width: 100%;">
                    <input type="hidden" name="type" th:value="${isSale}" />
                    <input type="hidden" name="city" th:value="${city}" />
                    <input id="autocomplete"
                           class="search-input"
                           placeholder="Search locality or landmark"
                           name="query"
                           th:value="${searchQuery}"

                           style="flex: 1; padding: 8px;
                               font-size: 14px; border: 1px solid #ccc; border-radius: 4px;" />
                    <button type="submit" style="padding: 8px 14px; background-color: #ff4c5b; color: white; border: none; border-radius: 4px; ">Search</button>
                </form>
                <form method="get" action="/getProperties" id="sortForm">
                    <input type="hidden" name="type" th:value="${isSale}" />
                    <input type="hidden" name="city" th:value="${city}" />
                    <input type="hidden" name="query" th:value="${searchKeyword}" />
                    <select name="sortBy" onchange="document.getElementById('sortForm').submit()" class="sort-dropdown">
                        <option value="">NoBroker Rank</option>
                        <option value="newest" th:selected="${sortBy == 'newest'}">Newest to Oldest</option>
                        <option value="oldest" th:selected="${sortBy == 'oldest'}">Oldest to Newest</option>
                        <option value="priceHighLow" th:selected="${sortBy == 'priceHighLow'}">Price: High to Low</option>
                        <option value="priceLowHigh" th:selected="${sortBy == 'priceLowHigh'}">Price: Low to High</option>
                    </select>
                </form>
            </div>

            <div id="properties-container" class="properties-container">
                <div id="post-list" th:replace="~{fragments/postSection :: postSection(allProperties=${allProperties}, hasNext=${totalPages > currentPage + 1})}"></div>
            </div>
        </div>
    </div>
    <div style="width: 20%"></div>
</div>
</body>
<script>
    // static/js/bookmark.js
    function toggleBookmark(button) {
        const propertyId = button.getAttribute('data-property-id');

        console.log("Bookmark clicked:", propertyId);

        fetch(`/toggleBookmark/${propertyId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(res => {
                if (!res.ok) throw new Error("Network response was not ok");
                return res.json();
            })
            .then(data => {
                if (data.success) {
                    button.style.color = data.bookmarked ? 'red' : '#ccc';
                } else {
                    alert("Failed to update bookmark");
                }
            })
            .catch(err => {
                console.error("Bookmark error:", err);
                alert("Something went wrong while bookmarking.");
            });
    }


    // Add this function to handle premium filter clicks
    function checkSubscriptionAndRedirect(event) {
        // Check if the click was on a form element (we don't want to intercept those)
        if (event.target.tagName === 'INPUT' || event.target.tagName === 'BUTTON' || event.target.tagName === 'SELECT') {
            return; // Let the normal form behavior happen
        }

        event.preventDefault();

        fetch("/subscribeOrNot")
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                if (data.subscribed === true) {
                    // If subscribed, switch to premium tab
                    switchTab('premium');
                } else {
                    // If not subscribed, redirect to subscription page
                    window.location.href = "/subscriptionForm";
                }
            })
            .catch(error => {
                console.error("Error checking subscription:", error);
                alert("Something went wrong while checking subscription status.");
            });
    }

    // Modify your premium filter form submission
    document.getElementById('premium-filter-form')?.addEventListener('submit', function(e) {
        e.preventDefault();

        fetch("/subscribeOrNot")
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                if (data.subscribed === true) {
                    // If subscribed, submit the form
                    this.submit();
                } else {
                    // If not subscribed, redirect to subscription page
                    window.location.href = "/subscribe";
                }
            })
            .catch(error => {
                console.error("Error checking subscription:", error);
                alert("Something went wrong while checking subscription status.");
            });
    });
</script>

<script>
    let page = [[${currentPage}]];
    let loading = false;
    let hasMore = [[${totalPages > currentPage + 1}]];

    // Build the base URL with all filter parameters
    const params = new URLSearchParams(window.location.search);
    params.delete('page'); // Remove page param to append it dynamically
    const baseURL = `/loadMorePosts?${params.toString()}`;

    const observer = new IntersectionObserver(async (entries) => {
        const entry = entries[0];
        if (entry.isIntersecting && !loading && hasMore) {
            loading = true;
            page++;

            try {
                const response = await fetch(`${baseURL}&page=${page}&size=5`);
                if (response.ok) {
                    const html = await response.text();
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = html;

                    const newPosts = tempDiv.querySelectorAll('.property-card');
                    const container = document.getElementById('properties-container');

                    if (newPosts.length === 0) {
                        hasMore = false;
                    } else {
                        newPosts.forEach(post => container.appendChild(post));
                    }

                    // Check if the response includes a new trigger point (indicating hasNext)
                    const newTrigger = tempDiv.querySelector('#trigger-point');
                    if (newTrigger) {
                        container.appendChild(newTrigger);
                        observer.observe(newTrigger);
                    } else {
                        hasMore = false;
                    }
                } else {
                    hasMore = false;
                }
            } catch (error) {
                console.error('Error loading more posts:', error);
                hasMore = false;
            } finally {
                loading = false;
            }
        }
    }, { threshold: 1.0 });

    window.addEventListener('DOMContentLoaded', () => {
        const trigger = document.getElementById('trigger-point');
        if (trigger && hasMore) {
            observer.observe(trigger);
        }
    });

    // Get filter type from URL parameters to determine which tab should be active
    function getUrlParameter(name) {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        var results = regex.exec(location.search);
        return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    }

    // Filter tab switching functionality
    function switchTab(tabType) {
        const filterTabs = document.querySelectorAll('.filter-tab');
        const basicFilters = document.getElementById('basic-filters');
        const premiumFilters = document.getElementById('premium-filters');

        // Remove active class from all tabs
        filterTabs.forEach(tab => {
            tab.classList.remove('active');
        });

        if (tabType === 'basic') {
            basicFilters.style.display = 'block';
            premiumFilters.style.display = 'none';
            filterTabs[0].classList.add('active');
            premiumFilters.classList.remove('active');
        } else if (tabType === 'premium') {
            basicFilters.style.display = 'none';
            premiumFilters.style.display = 'block';
            filterTabs[1].classList.add('active');
            premiumFilters.classList.add('active');
        }
    }

    // Initialize page when DOM loads
    document.addEventListener('DOMContentLoaded', function() {
        // Check if premium filters were used (look for filterType parameter or premium-specific parameters)
        const filterType = getUrlParameter('filterType');
        const propertyAge = getUrlParameter('propertyAge');
        const parking = getUrlParameter('parking');

        // If premium filter was applied OR premium-specific parameters exist, show premium tab
        if (filterType === 'premium' || propertyAge || parking) {
            switchTab('premium');
        } else {
            switchTab('basic');
        }

        // Add event listeners to tabs
        const filterTabs = document.querySelectorAll('.filter-tab');
        if (filterTabs.length >= 2) {
            filterTabs[0].addEventListener('click', function() {
                switchTab('basic');
            });

            filterTabs[1].addEventListener('click', function() {
                switchTab('premium');
            });
        }
    });



    function syncRentRange() {
        const minSlider = document.getElementById("minRentSlider");
        const maxSlider = document.getElementById("maxRentSlider");
        let minValue = parseInt(minSlider.value);
        let maxValue = parseInt(maxSlider.value);

        // Prevent sliders from crossing
        if (minValue > maxValue - 1000) {
            minValue = maxValue - 1000;
            minSlider.value = minValue;
        } else if (maxValue < minValue + 1000) {
            maxValue = minValue + 1000;
            maxSlider.value = maxValue;
        }

        // Update UI display
        document.getElementById("minDisplay").textContent = minValue.toLocaleString();
        document.getElementById("maxDisplay").textContent = maxValue.toLocaleString();
        document.getElementById("minValue").textContent = minValue.toLocaleString();
        document.getElementById("maxValue").textContent = maxValue.toLocaleString();

        // Update slider track
        const sliderTrack = document.getElementById("sliderTrack");
        const minPercent = (minValue / 500000) * 100;
        const maxPercent = (maxValue / 500000) * 100;
        sliderTrack.style.left = minPercent + '%';
        sliderTrack.style.width = (maxPercent - minPercent) + '%';

        // Trigger form submission or AJAX request
        submitFilters();
    }

    function syncAreaRange() {
        const minSlider = document.getElementById("minAreaSlider");
        const maxSlider = document.getElementById("maxAreaSlider");
        let minValue = parseInt(minSlider.value);
        let maxValue = parseInt(maxSlider.value);

        if (minValue > maxValue - 100) {
            minValue = maxValue - 100;
            minSlider.value = minValue;
        } else if (maxValue < minValue + 100) {
            maxValue = minValue + 100;
            maxSlider.value = maxValue;
        }

        // Update UI display
        document.getElementById("minAreaDisplay").textContent = minValue.toLocaleString();
        document.getElementById("maxAreaDisplay").textContent = maxValue.toLocaleString();
        document.getElementById("minAreaValue").textContent = minValue.toLocaleString();
        document.getElementById("maxAreaValue").textContent = maxValue.toLocaleString();

        // Update slider track
        const sliderTrack = document.getElementById("areaTrack");
        const minPercent = (minValue / 10000) * 100;
        const maxPercent = (maxValue / 10000) * 100;
        sliderTrack.style.left = minPercent + '%';
        sliderTrack.style.width = (maxPercent - minPercent) + '%';

        // Trigger form submission or AJAX request
        submitFilters();
    }

    // Function to submit filters (implement based on your form submission logic)
    // function submitFilters() {
    //     document.querySelector('form').submit();
    // }


</script>

<script>
    let autocomplete;

    function initAutocomplete() {
        autocomplete = new google.maps.places.Autocomplete(
            document.getElementById("autocomplete"),
            {
                types: ['geocode'],
                componentRestrictions: { country: "in" }
            }
        );

        autocomplete.addListener("place_changed", function () {
            const place = autocomplete.getPlace();
            console.log("Selected:", place.formatted_address || place.name);

            // Optional: If you want lat/lng, use:
            const loc = place.geometry?.location;
            if (loc) {
                console.log("Lat:", loc.lat(), "Lng:", loc.lng());
            }
        });
    }
</script>

<script async
        defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDz0-n_B5lraC2FOztlv7-T4BQtPt9PPX0&libraries=places&callback=initAutocomplete">
</script>
</html>